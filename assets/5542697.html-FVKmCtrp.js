import{_ as s}from"./plugin-vue_export-helper-x3n3nnut.js";import{r,o as l,c as o,b as e,d as n,e as t,f as a}from"./app-5ZyUDSyM.js";const d={},c={href:"http://www1.360quan.com/blog/show/4823429",target:"_blank",rel:"noopener noreferrer"},u=e("h2",{id:"rewrite-function",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#rewrite-function","aria-hidden":"true"},"#"),n(" Rewrite Function")],-1),h=e("p",null,"The main function of Rewirte is to realize URL redirection, and its regular expressions are based on Perl language. It can be based on server level (httpd.conf) and directory level (.htaccess). If you want to use the rewrite module, you must first install or load the rewrite module. There are two methods, one is to install the rewrite module directly when compiling apache, the other is to install apache in DSO mode when compiling apache, and then use the source code and apxs to install the rewrite module.",-1),m=e("p",null,"Based on the server level (httpd.conf), there are two methods, one is to directly use RewriteEngine on to open the rewrite function under the global httpd.conf; the other is to use RewriteEngine on to open the rewrite function locally, the following will An example will be given. It should be noted that the rewrite function must be turned on with RewriteEngine on in each virtualhost. Otherwise, if there is no RewriteEngine on in the virtualhost, the rules in it will not take effect.",-1),p=e("p",null,"Based on directory level (.htaccess), one thing to note is that the FollowSymLinks property of this directory must be turned on and RewriteEngine on must be declared in .htaccess.",-1),w=e("h2",{id:"examples",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#examples","aria-hidden":"true"},"#"),n(" Examples")],-1),v={href:"http://www.kiya.cn",target:"_blank",rel:"noopener noreferrer"},b=e("code",null,"http://www.kiya.cn",-1),g=e("code",null,"http://kiya.cn",-1),f=a(`<div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>NameVirtualHost 70.40.213.183:80
ServerAdmin slj@kiya.cn
DocumentRoot &quot;/web&quot;
ServerName kiya.cn
RewriteEngine on #Open the rewirte function
RewriteCond %{HTTP_HOST} !^www.kiya.cn [NC] #declare that the prefix in the host requested by Client is not www.kiya.cn, where [NC] means ignore case
RewriteCond %{HTTP_HOST} !^70.40.213.183 [NC] #declare that the prefix in the host requested by Client is not 70.40.213.183, where [NC] means ignore case
RewriteCond %{HTTP_HOST} !^$ #declare that the prefix in the host requested by Client is not empty
RewriteRule ^(.*) http://www.kiya.cn/ [L] #The meaning is that if the prefix in the host requested by the Client meets the above conditions, it will directly jump to &#39;http://www.kiya.cn /&#39;,[L] means stop the rewrite operation immediately and no other rewrite rules will be applied. The .* here means to match all URLs that do not contain newline characters. The function of the () brackets is to mark all the characters for later application. It is to quote the (.*) characters in the front.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example 2. Jump to <code>www.tsas.cn</code> when entering the domain name of <code>en.tsas.cn</code></p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>RewriteEngine on
RewriteCond %{HTTP_HOST} ^en.tsas.cn [NC]
RewriteRule ^(.*) &lt;http://www.tsas.cn/&gt; [L]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example 3. Tsas Software has recently changed its domain name. The new domain name is <code>www.tsas.cn</code>, which is shorter and easier to remember. At this time, it is necessary to direct the original domain name <code>ss.kiya.cn</code> and the address of the forum <code>ss.kiya.cn/bbs/</code> to the new domain name so that users can find it, and the original forum URL continues to be valid instead of 404 not found, such as the original <code>http://ss.kiya.cn/bbs/tread-60.html</code>, let it continue to be valid under the new domain name, click and forward to <code>http://bbs.tsas .cn/tread-60.html</code>, and other webpages, such as the original <code>http://ss.kiya.cn/purchase</code> will not go to the second-level domain name <code>bbs.tsas.cn/purchase</code>, but to <code>www.tsas.cn/purchase</code><br> According to such requirements, the redirection rule should be written like this:</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>Rewrite Engine On
RewriteCond %{REQUEST_URI} ^/bbs/
RewriteRule ^bbs/(.*) http://bbs.tsas.cn/$1 [R=permanent,L]
RewriteCond %{REQUEST_URI} !^/bbs/
RewriteRule ^(.*) http://www.tsas.cn/$1 [R=permanent,L]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="list-of-flags-rewritten-by-apache-mod-rewrite-rules" tabindex="-1"><a class="header-anchor" href="#list-of-flags-rewritten-by-apache-mod-rewrite-rules" aria-hidden="true">#</a> List of flags rewritten by Apache mod_rewrite rules</h2><ol><li>R[=code](force redirect) force external redirection<br> Forcibly prefix the replacement string with <code>http://thishost[:thisport]/</code> to redirect to an external URL. If code is not specified, the default 302 HTTP status code will be used.</li><li>F (force URL to be forbidden) disables the URL and returns a 403 HTTP status code.</li><li>G(force URL to be gone) Force the URL to be GONE, return 410HTTP status code.</li><li>P (force proxy) Forces the use of proxy forwarding.</li><li>L(last rule) indicates that the current rule is the last rule, and the rewriting of the rule after the analysis is stopped.</li><li>N(next round) reruns the rewriting process starting from the first rule.</li><li>C(chained with next rule) is associated with the next rule</li></ol><p>If the rule matches, it will be processed normally. If the flag is not matched, all the following associated rules will be skipped.</p><ol start="8"><li>T=MIME-type(force MIME type) Force MIME type</li><li>NS (used only if no internal sub-request) is only used for not internal sub-requests</li><li>NC(no case) case insensitive</li><li>QSA(query string append) Append request string</li><li>NE(no URI escaping of output) does not output escaping special characters<br> For example: RewriteRule /foo/(.*) /bar?arg=P1%3d$1 [R,NE] will correctly convert /foo/zoo to /bar?arg=P1=zoo</li><li>PT(pass through to next handler) Pass to the next processing<br> For example:<br> RewriteRule ^/abc(.*) /def$1 [PT] # will be handed over to the /def rule for processing<br> Alias /def /ghi</li><li>S=num(skip next rule(s)) skip num rules</li><li>E=VAR:VAL(set environment variable) Set environment variable</li></ol><h2 id="apache-rewrite-example-collection" tabindex="-1"><a class="header-anchor" href="#apache-rewrite-example-collection" aria-hidden="true">#</a> Apache rewrite example collection</h2><p>URL redirection</p><p>Example one:<br> Meet the following two requirements at the same time:</p><ol><li>Use <code>http://www.zzz.com/xxx.php</code> to visit <code>http://www.zzz.com/xxx/</code></li><li>Use <code>http://yyy.zzz.com</code> to access <code>http://www.zzz.com/user.php?username=yyy</code> function</li></ol><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>Rewrite Engine On
RewriteCond %{HTTP_HOST} ^www.zzz.com
RewriteCond %{REQUEST_URI} !^user.php$
RewriteCond %{REQUEST_URI}.php$
RewriteRule (.*).php$ http://www.zzz.com/$1/ [R]
RewriteCond %{HTTP_HOST} !^www.zzz.com
RewriteRule ^(.+) %{HTTP_HOST} [C]
RewriteRule ^([^.]+).zzz.com http://www.zzz.com/user.php?username=$1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example two:</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>/type.php?typeid=*–&gt; /type*.html
/type.php?typeid=*&amp;page=* –&gt; /type*page*.html

RewriteRule ^/type([0-9]+).html$ /type.php?typeid=$1 [PT]
RewriteRule ^/type([0-9]+)page([0-9]+).html$ /type.php?typeid=$1&amp;page=$2 [PT]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="use-apache-s-url-rewrite-to-configure-a-multi-user-virtual-server" tabindex="-1"><a class="header-anchor" href="#use-apache-s-url-rewrite-to-configure-a-multi-user-virtual-server" aria-hidden="true">#</a> Use Apache&#39;s URL Rewrite to configure a multi-user virtual server</h2><p>To realize this function, you must first open the pan-domain name resolution of the domain name on the DNS server (do it yourself or find a domain name service provider to do it). For example, I resolve all <em>.kiya.us and</em>.kiya.cn to my IP address 70.40.213.183.</p><p>Then, take a look at the settings of the *.kiya.us virtual host in my Apache.</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>ServerAdmin webmaster@kiya.us
DocumentRoot /home/www/www.kiya.us
ServerName dns.kiya.us
ServerAlias dns.kiya.us kiya.us *.kiya.us
CustomLog /var/log/httpd/osa/access_log.log” common
ErrorLog /var/log/httpd/osa/error_log.log” AllowOverride None Order deny, allow #AddDefaultCharset GB2312
RewriteEngine on
RewriteCond %{HTTP_HOST} ^[^.]+.kiya.(cn|us)$
RewriteRule ^(.+) %{HTTP_HOST}$1 [C]
RewriteRule ^([^.]+).kiya.(cn|us)(.*)$ /home/www/www.kiya.us/sylvan$3?un=$1&amp;%{QUERY_STRING} [L]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>In this setting, I set the Document Root of <em>.kiya.cn and</em>.kiya.us to /home/www/www.kiya.us</p><p>Continue to read, here I have configured URL Rewrite rules.</p><p>the following sentence</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>RewriteRule ^(.+) %{HTTP_HOST}$1 [C] #Pass the complete address entered by the user (except GET parameters) as a parameter to the next rule, [C] means Chain to connect the next rule
RewriteRule ^([^.]+).kiya.(cn|us)(.*)$ /home/www/dev.kiya.us/sylvan$3?un=$1&amp;%{QUERY_STRING} [L]
# The most important thing is this sentence, use regular expressions to parse the URL address entered by the user, and pass the user name information in the host name as a parameter named un to the script in the /home/www/dev.kiya.us directory , followed by the incoming parameters of the GET method input by the user. And indicate that this is the last rule ([L] rule).
# Note that the rewritten address specified in this sentence uses the absolute path on the server, which is an internal jump. If a URL format like http://xxxx is used, it is called an external redirect. If you use an external redirect, the URL address in the browsing browser will change to a new address, while using an internal redirect, the address in the browser will not change, which looks more like an actual second-level domain name virtual server.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>After setting, restart the Apache server and you&#39;re done!</p><p>Update May 1, 2009</p><p>I came across a question on the Internet today:</p>`,27),x=e("br",null,null,-1),R={href:"http://www.im286.com",target:"_blank",rel:"noopener noreferrer"},y={href:"http://www.chinaz.com",target:"_blank",rel:"noopener noreferrer"},_=a(`<p>The answer in the forum is:</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>Rewrite Engine On
RewriteCond %{HTTP_REFERER} chinaz.com [NC]
RewriteCond %{HTTP_REFERER} im286.com [NC] RewriteRule .*.(jpg|jpeg|gif|png|rar|zip|txt|ace|torrent|gz|swf)$ http://www.xxx.com/fuck .png [R,NC,L]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Update May 7, 2009</p>`,3),T=e("br",null,null,-1),k={href:"http://lamp.linux.gov.cn/Apache/ApacheMenu/mod/mod_rewrite.html",target:"_blank",rel:"noopener noreferrer"},E=a(`<p>Update May 24, 2009</p><p>1.Whether you need to use full escaping, for example, in</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>RewriteCond %{HTTP_REFERER} chinaz.com [NC]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Change <code>chinaz.com</code> to <code>chinaz.com</code></p><p>The answer is, both are possible.</p><p>2.Today, when I was working on <code>YOURcaddy.com</code> (the transformation of PlanetCoachella I made last year), the GoDaddy host could not turn normally. Later, I found the problem:<br> On HostMonster as well as my own machine, the</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>RewriteRule ^business/([^.]+)$ biz/detail.php?name=$1 [L]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>reached rewritten. And on the Godaddy host, it looks like this:</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>RewriteRule ^business/([^.]+)$ /biz/detail.php?name=$1 [L]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>There is an extra / before the target file<br> Thinking about it now, it may be because RewriteBase is not specified. As for whether it is true, I will verify it another day.</p><p>3.Add two examples about judging USER AGENT and automatically adding .php extensions and automatically changing .html to .php extensions:<br> 1</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>RewriteEngine on
RewriteCond %{HTTP_USER_AGENT} ^MSIE [NC,OR]
RewriteCond %{HTTP_USER_AGENT} ^Opera [NC]
RewriteRule ^.* – [F,L] #here &quot;-&quot; means no replacement, visitors whose browsers are IE and Opera will be prohibited from accessing.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>Rewrite Engine On
RewriteBase /test
RewriteCond %{REQUEST_FILENAME}.php -f
RewriteRule ([^/]+)$ /test/$1.php #for example: /test/admin =&gt; /test/admin.php
RewriteRule ([^/]+).html$ /test/$1.php [L] #for example: /test/admin.html =&gt; /test/admin.php
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Restrict the directory to only display images</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>IfModule</span> <span class="token attr-name">mod_rewrite.c</span><span class="token punctuation">&gt;</span></span>
RewriteEngine on
RewriteCond %{REQUEST_FILENAME} !^.*.(gif|jpg|jpeg|png|swf)$
RewriteRule .*$ – [F,L]
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>IfModule</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Update Jun 10, 2009</p><p>Added, rewrites regarding specific file extensions.</p><p>Rewrite files with certain extensions:</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>RewriteRule (.*.css$|.*.js$) gzip.php?$1 [L]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>If you want to exclude some extensions:</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>RewriteRule !.(js|ico|gif|jpg|JPG|png|PNG|css|pdf|swf)$ index.php
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,22);function C(z,I){const i=r("ExternalLinkIcon");return l(),o("div",null,[e("p",null,[n("The article is transferred from: "),e("a",c,[n("http://www1.360quan.com/blog/show/4823429"),t(i)])]),u,h,m,p,w,e("p",null,[n("Example 1. The following are the rules defined in a virtual host. The function is to redirect the host prefix requested by the client not "),e("a",v,[n("www.kiya.cn"),t(i)]),n(" and 70.40.213.183 to the host prefix "),b,n(", avoiding multiple domain names pointing to webpages with the same content, such as "),g,n(".")]),f,e("p",null,[n("Seeking Rewrite anti-leech rules"),x,n(" How to write the rules that "),e("a",R,[n("www.im286.com"),t(i)]),n(" and "),e("a",y,[n("www.chinaz.com"),t(i)]),n(" are not allowed to hotlink, and other websites are allowed to hotlink.")]),_,e("p",null,[n("Introduce an article:"),T,e("a",k,[n("http://lamp.linux.gov.cn/Apache/ApacheMenu/mod/mod_rewrite.html"),t(i)])]),E])}const U=s(d,[["render",C],["__file","5542697.html.vue"]]);export{U as default};
