import{_ as p}from"./plugin-vue_export-helper-x3n3nnut.js";import{r as o,o as i,c,b as n,d as s,e as t,f as e}from"./app-5ZyUDSyM.js";const l="/assets/img-20230409101309-cHbgmz49.gif",u="/assets/img-20230409105133-VUzoR9K9.png",r="/assets/img-20230409105244-ZBNAw-ZE.png",d="/assets/img-20230409110208-vSzAKXxL.png",k="/assets/img-20230409110233-EwrgXxZn.png",m="/assets/img-20230409112903-lzYKv-zx.png",v="/assets/img-20230409113014-vncJ8ZyI.png",b="/assets/img-20230409113036-PrNu9xCR.png",h={},g=e(`<p>​</p><h2 id="preface" tabindex="-1"><a class="header-anchor" href="#preface" aria-hidden="true">#</a> Preface</h2><p>This article mainly introduces how to use the TensorFlow primary API through a simple demo. Because I am also a beginner, the purpose of this article is to guide students who are new to TensorFlow or machine learning to learn TensorFlow from the first step. After reading this article, first confirm that you have the following basic skills:</p><ul><li><p>Can use Python programming (beginner is OK, in fact, TensorFlow also supports Java, C++, Go)</p></li><li><p>Some knowledge related to arrays (as long as linear algebra is not forgotten)</p></li><li><p>It is better to know some knowledge related to machine learning (Temporary Baidu, Google also have time)</p></li></ul><h2 id="basics" tabindex="-1"><a class="header-anchor" href="#basics" aria-hidden="true">#</a> Basics</h2><h3 id="tensor" tabindex="-1"><a class="header-anchor" href="#tensor" aria-hidden="true">#</a> Tensor</h3><p>The calculations inside TensorFlow are all based on tensors, so we need to have an understanding of tensors first. Tensors are defined on top of scalars and vectors that we are familiar with. The detailed definition is more complicated. We can simply understand it as a multidimensional array:</p><div class="language-txt line-numbers-mode" data-ext="txt"><pre class="language-txt"><code>3 # This 0-rank tensor is a scalar, shape=[]
[1., 2., 3.] # This rank 1 tensor is a vector, shape=[3]
[[1., 2., 3.], [4., 5., 6.]] # This rank 2 tensor is a two-dimensional array, shape=[2, 3]
[[[1., 2., 3.]], [[7., 8., 9.]]] # This third-order tensor is a three-dimensional array, shape=[2, 1, 3]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>TensorFlow internally uses instances of the <code>tf.Tensor</code> class to represent tensors, and each <code>tf.Tensor</code> has two attributes:</p><ul><li><p><em>dtype</em> The type of data stored by Tensor, which can be <code>tf.float32</code>, <code>tf.int32</code>, <code>tf.string</code>…</p></li><li><p><em>shape</em> The number of elements in each dimension of the multidimensional array stored by Tensor, such as shape in the above example</p></li></ul><p>We can now take a look at Tensor with a few lines of code. Enter python or python3 in the command terminal to start a Python session, then enter the following code:</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment"># import tensorflow module</span>
<span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf

<span class="token comment"># Create an integer constant, a Tensor of order 0</span>
t0 <span class="token operator">=</span> tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>tf<span class="token punctuation">.</span>int32<span class="token punctuation">)</span>

<span class="token comment"># Create a one-dimensional array of floating point numbers, that is, a rank 1 Tensor</span>
t1 <span class="token operator">=</span> tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3.</span><span class="token punctuation">,</span> <span class="token number">4.1</span><span class="token punctuation">,</span> <span class="token number">5.2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>

<span class="token comment"># Create a 2x2 array of strings, i.e. a rank 2 Tensor</span>
t2 <span class="token operator">=</span> tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&#39;Apple&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;Orange&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#39;Potato&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;Tomato&#39;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>tf<span class="token punctuation">.</span>string<span class="token punctuation">)</span>

<span class="token comment"># Create a 2x3x1 array, that is, a rank 3 tensor, and the default data type is integer</span>
t3 <span class="token operator">=</span> tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># Print several Tensors created above</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>t0<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>t1<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>t2<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>t3<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The output of the above code is, pay attention to the type of <code>shape</code>:</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>t0<span class="token punctuation">)</span>
Tensor<span class="token punctuation">(</span><span class="token string">&quot;Const:0&quot;</span><span class="token punctuation">,</span> shape<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>int32<span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>t1<span class="token punctuation">)</span>
Tensor<span class="token punctuation">(</span><span class="token string">&quot;Const_1:0&quot;</span><span class="token punctuation">,</span> shape<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>float32<span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>t2<span class="token punctuation">)</span>
Tensor<span class="token punctuation">(</span><span class="token string">&quot;Const_2:0&quot;</span><span class="token punctuation">,</span> shape<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>string<span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>t3<span class="token punctuation">)</span>
Tensor<span class="token punctuation">(</span><span class="token string">&quot;Const_3:0&quot;</span><span class="token punctuation">,</span> shape<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>int32<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>print a Tensor can only print out its attribute definition, but not its value. To view the value in a Tensor, you need to run it through the Session:</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> sess <span class="token operator">=</span> tf<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>sess<span class="token punctuation">.</span> run<span class="token punctuation">(</span>t0<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token number">3</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>sess<span class="token punctuation">.</span> run<span class="token punctuation">(</span>t1<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span> <span class="token number">3.</span> <span class="token number">4.0999999</span> <span class="token number">5.19999981</span><span class="token punctuation">]</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>sess<span class="token punctuation">.</span> run<span class="token punctuation">(</span>t2<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">b&#39;Apple&#39;</span> <span class="token string">b&#39;Orange&#39;</span><span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token string">b&#39;Potato&#39;</span> <span class="token string">b&#39;Tomato&#39;</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>sess<span class="token punctuation">.</span> run<span class="token punctuation">(</span>t3<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span>
   <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span>
   <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
 
  <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span>
   <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>
   <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="dataflow-graph" tabindex="-1"><a class="header-anchor" href="#dataflow-graph" aria-hidden="true">#</a> Dataflow Graph</h3><p>Data flow is a commonly used parallel computing programming model. The data flow graph is a directed graph composed of <code>nodes</code> and <code>edges</code>:</p><ul><li><p><strong>nodes(nodes)</strong> represent computing units, which can also be the starting point of input or the end point of output</p></li><li><p><strong>lines(edges)</strong> represent input/output relationships between nodes</p></li></ul><p>In TensorFlow, each node is represented by an instance of <code>tf.Tensor</code>, that is, the input and output of each node are Tensor, as shown in the figure below, the flow of Tensor in the Graph vividly shows the origin of the name TensorFlow</p><figure><img src="`+l+`" alt="Flow of Tensor in Graph" tabindex="0" loading="lazy"><figcaption>Flow of Tensor in Graph</figcaption></figure><p>Dataflow graphs in TensorFlow have several advantages:</p><ul><li><p><strong>Parallel</strong> Computing nodes are connected by clear lines, and the system can easily determine which computing operations can be executed in parallel</p></li><li><p><strong>Distributable</strong> Each node in the graph can be distributed in different computing units (CPU, GPU, TPU, etc.) or different machines, and the data generated by each node can be sent to the next node through a clear line</p></li><li><p><strong>Optimizable</strong> The XLA compiler in TensorFlow can optimize the code according to the data flow graph to speed up the operation</p></li><li><p><strong>Portable</strong> The information of the data flow graph can be saved without relying on the code, such as a graph created with Python, which can be used in C++ or Java after saving</p></li></ul><h3 id="sesssion" tabindex="-1"><a class="header-anchor" href="#sesssion" aria-hidden="true">#</a> Sesssion</h3><p>When we need to do some calculation operations in Python, we generally use NumPy. When NumPy does complex calculations such as matrix operations, it uses other languages ​​(C/C++) to implement these calculation logics to ensure the efficiency of calculations. However, frequent switching between multiple programming languages will also consume a certain amount of time. If it is only a stand-alone operation, the time-consuming may be negligible, but in distributed parallel computing, computing operations may be distributed in different CPUs, GPUs or even In different machines, these time-consuming may be more serious.<br> The underlying layer of TensorFlow is implemented in C++ to ensure computational efficiency, and the <code>tf.Session</code> class is used to connect the client program with the C++ runtime. The upper-level Python, Java and other codes are used to design and define the model, build the Graph, and finally pass it to the bottom layer for execution through the <code>tf.Session.run()</code> method.</p><h3 id="build-a-computational-graph" tabindex="-1"><a class="header-anchor" href="#build-a-computational-graph" aria-hidden="true">#</a> Build a computational graph</h3><p>The above is the concept of TensorFlow and Graph, and the following describes how to use Tensor to build Graph.<br> Tensor can represent input and output endpoints, and can also represent computing units. The following code creates a Tensor that performs + operations on two Tensors:</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf

<span class="token comment"># Create two constant nodes</span>
node1 <span class="token operator">=</span> tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span><span class="token number">3.2</span><span class="token punctuation">)</span>
node2 <span class="token operator">=</span> tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span><span class="token number">4.8</span><span class="token punctuation">)</span>

<span class="token comment"># Create an adder node and perform + operation on the above two nodes</span>
adder <span class="token operator">=</span> node1 <span class="token operator">+</span> node2

<span class="token comment"># print the adder node</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>adder<span class="token punctuation">)</span>

<span class="token comment"># Print the result of adder running</span>
sess <span class="token operator">=</span> tf<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>sess<span class="token punctuation">.</span> run<span class="token punctuation">(</span>adder<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The output of <code>print</code> above is:</p><blockquote><p>Tensor(&quot;add:0&quot;, shape=(), dtype=float32)<br> 8.0</p></blockquote><p>The Tensors created above using <code>tf.constant()</code> are all constants, and once created, the values in them cannot be changed. Sometimes we also need to input data from the outside. At this time, we can use <code>tf.placeholder</code> to create a placeholder Tensor, and the value of the placeholder Tensor can be input at runtime. The following is an example of creating a placeholder Tensor:</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf

<span class="token comment"># Create two placeholder Tensor nodes</span>
a <span class="token operator">=</span> tf<span class="token punctuation">.</span>placeholder<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>
b <span class="token operator">=</span> tf<span class="token punctuation">.</span>placeholder<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>

<span class="token comment"># Create an adder node and perform + operation on the above two nodes</span>
adder_node <span class="token operator">=</span> a <span class="token operator">+</span> b

<span class="token comment"># print three nodes</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>adder<span class="token punctuation">)</span>

<span class="token comment"># Run it, the following dict parameter is to provide input data for the placeholder Tensor</span>
sess <span class="token operator">=</span> tf<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>sess<span class="token punctuation">.</span> run<span class="token punctuation">(</span>adder<span class="token punctuation">,</span> <span class="token punctuation">{</span>a<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token number">4.5</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>adder<span class="token punctuation">,</span> <span class="token punctuation">{</span>a<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The output of the above code is:</p><blockquote><p>Tensor(&quot;Placeholder:0&quot;, dtype=float32)<br> Tensor(&quot;Placeholder_1:0&quot;, dtype=float32)<br> Tensor(&quot;add:0&quot;, dtype=float32)<br> 7.5<br> [ 3. 7.]</p></blockquote><p>We can also add other operations to build complex Graphs</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment"># Add × operation</span>
add_and_triple <span class="token operator">=</span> adder <span class="token operator">*</span> <span class="token number">3.</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>sess<span class="token punctuation">.</span> run<span class="token punctuation">(</span>add_and_triple<span class="token punctuation">,</span> <span class="token punctuation">{</span>a<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token number">4.5</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The output of the above is</p><blockquote><p>22.5</p></blockquote><h2 id="tensorflow-application-example" tabindex="-1"><a class="header-anchor" href="#tensorflow-application-example" aria-hidden="true">#</a> TensorFlow application example</h2><p>The above introduces some basic concepts in TensorFlow. Let&#39;s use a small example to understand how to use TensorFlow for machine learning.</p><h3 id="build-a-model-model" tabindex="-1"><a class="header-anchor" href="#build-a-model-model" aria-hidden="true">#</a> Build a model (Model)</h3><p>The following are some experimental data we obtained from an experiment:</p><table><thead><tr><th>input</th><th>output</th></tr></thead><tbody><tr><td>1</td><td>4.8</td></tr><tr><td>2</td><td>8.5</td></tr><tr><td>3</td><td>10.4</td></tr><tr><td>6</td><td>21</td></tr><tr><td>8</td><td>25.3</td></tr></tbody></table><p>We can see these data more intuitively by putting them on a two-dimensional graph, as follows, these data are represented as some discrete points in the graph:</p><figure><img src="`+u+'" alt="Test data" tabindex="0" loading="lazy"><figcaption>Test data</figcaption></figure><p>We need to derive a general model based on the existing data, through which we can predict the output value produced by other input values.<br> As shown in the figure below, the model we choose can be either a curve model represented by the red line that ghosts cannot understand, or a linear model represented by the blue line. In the analysis of probability statistics theory, the probability that these two models conform to the real model is the same.</p><figure><img src="'+r+'" alt="Assumption model" tabindex="0" loading="lazy"><figcaption>Assumption model</figcaption></figure><p>According to <strong>Occam&#39;s razor principle - if there are multiple assumptions consistent with observations, choose the simplest one</strong>, the linear model represented by the blue line is more in line with our intuitive expectations.<br> If x represents the input and y represents the output, the linear model can be represented by the following equation:</p><blockquote><p>$y = W \\times x + b$</p></blockquote><p>Even if we choose the linear model, there are many models to choose from. The three straight lines in the figure below all seem to be a reasonable model, but they are different from the parameters. At this time, we need to design a loss model (loss model) to evaluate which model is more reasonable and find the most accurate model.</p><figure><img src="'+d+'" alt="Optimized model" tabindex="0" loading="lazy"><figcaption>Optimized model</figcaption></figure><p>Each yellow line in the figure below represents the difference between the value calculated by the linear model and the actual output value:</p><figure><img src="'+k+`" alt="Loss model" tabindex="0" loading="lazy"><figcaption>Loss model</figcaption></figure><p>We use $y\\prime$ to represent the actual output obtained from the experiment, and use the following equation to represent our loss model:</p><blockquote><p>$loss=\\displaystyle\\sum_{n=1}<sup>N(y_n−y\\prime_n)</sup>2$</p></blockquote><p>Obviously, the smaller the loss model is, the more accurate our linear model is.</p><h3 id="implement-the-model-using-tensorflow" tabindex="-1"><a class="header-anchor" href="#implement-the-model-using-tensorflow" aria-hidden="true">#</a> Implement the model using TensorFlow</h3><p>Above we established a linear model based on the experimental data, and designed a loss model for this linear model. The following describes how to implement the model we designed in TensorFlow.<br> In our linear model $y = W \\times x + b$, the input $x$ can be represented by a placeholder Tensor, and the output $y$ can be represented by the output of the linear model. We need to constantly change $W$ and $ b$, to find a value that minimizes it. Here $W$ and $b$ can be represented by variable Tensor. Use <code>tf.Variable()</code> to create a variable Tensor, the following is the implementation code of our model:</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf

<span class="token comment"># Create variable W and b nodes, and set initial values</span>
W <span class="token operator">=</span> tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">.1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>
b <span class="token operator">=</span> tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">.1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>

<span class="token comment"># create x node for input data in experiment</span>
x <span class="token operator">=</span> tf<span class="token punctuation">.</span>placeholder<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>

<span class="token comment"># Create a linear model</span>
linear_model <span class="token operator">=</span> W<span class="token operator">*</span>x <span class="token operator">+</span> b

<span class="token comment"># Create a y node to input the output data obtained in the experiment for loss model calculation</span>
y <span class="token operator">=</span> tf<span class="token punctuation">.</span>placeholder<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>

<span class="token comment"># create loss model</span>
loss <span class="token operator">=</span> tf<span class="token punctuation">.</span>reduce_sum<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>square<span class="token punctuation">(</span>linear_model <span class="token operator">-</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># Create a Session to calculate the model</span>
sess <span class="token operator">=</span> tf<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>When creating a variable Tensor through <code>tf.Variable()</code>, you need to set an initial value, but this initial value cannot be used immediately. For example, in the above code, we use <code>print(sess.run(W))</code> to try to print <code>W</code>The value will get the following uninitialized exception</p><blockquote><p>tensorflow.python.framework.errors_impl.FailedPreconditionError: Attempting to use uninitialized value Variable</p></blockquote><p>The variable Tensor needs to go through the following <code>init</code> process before it can be used:</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment"># Initialize variables</span>
init <span class="token operator">=</span> tf<span class="token punctuation">.</span>global_variables_initializer<span class="token punctuation">(</span><span class="token punctuation">)</span>
sess<span class="token punctuation">.</span> run<span class="token punctuation">(</span>init<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>After that, use <code>print(sess.run(W))</code> to print and you can see the initial value we assigned before:</p><blockquote><p>[0.1]</p></blockquote><p>After the variables are initialized, we can run our linear model with the initial values <code>0.1</code> and <code>-0.1</code> set above for <code>W</code> and <code>b</code> to see the results:</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">print</span><span class="token punctuation">(</span>sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>linear_model<span class="token punctuation">,</span> <span class="token punctuation">{</span>x<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>The output is:</p><blockquote><p>[ 0. 0.1 0.20000002 0.5 0.69999999]</p></blockquote><p>It seems that there is a big gap with the actual output of our experiment, let&#39;s run the loss model again:</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">print</span><span class="token punctuation">(</span>sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>loss<span class="token punctuation">,</span> <span class="token punctuation">{</span>x<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">4.8</span><span class="token punctuation">,</span> <span class="token number">8.5</span><span class="token punctuation">,</span> <span class="token number">10.4</span><span class="token punctuation">,</span> <span class="token number">21.0</span><span class="token punctuation">,</span> <span class="token number">25.3</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>The loss value obtained is also large</p><blockquote><p>1223.05</p></blockquote><p>We can use <code>tf.assign()</code> to reassign <code>W</code> and <code>b</code> variables and check again:</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment"># assign new values to W and b</span>
fixW <span class="token operator">=</span> tf<span class="token punctuation">.</span> assign<span class="token punctuation">(</span>W<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2.</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
fixb <span class="token operator">=</span> tf<span class="token punctuation">.</span> assign<span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1.</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># The new value will take effect after run</span>
sess<span class="token punctuation">.</span> run<span class="token punctuation">(</span><span class="token punctuation">[</span>fixW<span class="token punctuation">,</span> fixb<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># Revalidate the loss value</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>loss<span class="token punctuation">,</span> <span class="token punctuation">{</span>x<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">4.8</span><span class="token punctuation">,</span> <span class="token number">8.5</span><span class="token punctuation">,</span> <span class="token number">10.4</span><span class="token punctuation">,</span> <span class="token number">21.0</span><span class="token punctuation">,</span> <span class="token number">25.3</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The output loss value is much smaller than before:</p><blockquote><p>159.94</p></blockquote><p>We need to constantly adjust the values ​​of the variables <code>W</code> and <code>b</code> to find <code>W</code> and <code>b</code> that minimize the loss value. This is definitely a very boring process, so TensorFlow provides a way to train the model, automatically helping us with these tedious training tasks.</p><h3 id="use-tensorflow-to-train-the-model" tabindex="-1"><a class="header-anchor" href="#use-tensorflow-to-train-the-model" aria-hidden="true">#</a> Use TensorFlow to train the model</h3><p>TensorFlow provides many optimization algorithms to help us train the model. The simplest optimization algorithm is the <strong>Gradient Descent</strong> algorithm, which finds the minimum loss value by continuously changing the values ​​of the variables in the model.<br> The following code is to use the gradient descent optimization algorithm to help us train the model:</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment"># Create a gradient descent optimizer with a learning rate of 0.001</span>
optimizer <span class="token operator">=</span> tf<span class="token punctuation">.</span>train<span class="token punctuation">.</span>GradientDescentOptimizer<span class="token punctuation">(</span><span class="token number">0.001</span><span class="token punctuation">)</span>
train <span class="token operator">=</span> optimizer<span class="token punctuation">.</span> minimize<span class="token punctuation">(</span>loss<span class="token punctuation">)</span>

<span class="token comment"># Use two arrays to save the training data</span>
x_train <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span>
y_train <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">4.8</span><span class="token punctuation">,</span> <span class="token number">8.5</span><span class="token punctuation">,</span> <span class="token number">10.4</span><span class="token punctuation">,</span> <span class="token number">21.0</span><span class="token punctuation">,</span> <span class="token number">25.3</span><span class="token punctuation">]</span>

<span class="token comment"># train 10000 times</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
     sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>train<span class="token punctuation">,</span> <span class="token punctuation">{</span>x<span class="token punctuation">:</span> x_train<span class="token punctuation">,</span> y<span class="token punctuation">:</span> y_train<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment"># print the training result</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;W: %s b: %s loss: %s&#39;</span> <span class="token operator">%</span> <span class="token punctuation">(</span>sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>W<span class="token punctuation">)</span><span class="token punctuation">,</span> sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">,</span> sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>loss<span class="token punctuation">,</span> <span class="token punctuation">{</span>x<span class="token punctuation">:</span> x_train <span class="token punctuation">,</span> y<span class="token punctuation">:</span> y_train<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The printed training results are as follows, and it can be seen that the loss value is already very small:</p><blockquote><p>W: [ 2.98236108] b: [ 2.07054377] loss: 2.12941</p></blockquote>`,83),f={href:"http://demo.py",target:"_blank",rel:"noopener noreferrer"},y=n("code",null,"python3 demo.py",-1),w=e(`<div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf

<span class="token comment"># Create variable W and b nodes, and set initial values</span>
W <span class="token operator">=</span> tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">.1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>
b <span class="token operator">=</span> tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">.1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>

<span class="token comment"># create x node for input data in experiment</span>
x <span class="token operator">=</span> tf<span class="token punctuation">.</span>placeholder<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>

<span class="token comment"># Create a linear model</span>
linear_model <span class="token operator">=</span> W <span class="token operator">*</span> x <span class="token operator">+</span> b

<span class="token comment"># Create a y node to input the output data obtained in the experiment for loss model calculation</span>
y <span class="token operator">=</span> tf<span class="token punctuation">.</span>placeholder<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>

<span class="token comment"># create loss model</span>
loss <span class="token operator">=</span> tf<span class="token punctuation">.</span>reduce_sum<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>square<span class="token punctuation">(</span>linear_model <span class="token operator">-</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># Create a Session to calculate the model</span>
sess <span class="token operator">=</span> tf<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># Initialize variables</span>
init <span class="token operator">=</span> tf<span class="token punctuation">.</span>global_variables_initializer<span class="token punctuation">(</span><span class="token punctuation">)</span>
sess<span class="token punctuation">.</span> run<span class="token punctuation">(</span>init<span class="token punctuation">)</span>

<span class="token comment"># Create a gradient descent optimizer with a learning rate of 0.001</span>
optimizer <span class="token operator">=</span> tf<span class="token punctuation">.</span>train<span class="token punctuation">.</span>GradientDescentOptimizer<span class="token punctuation">(</span><span class="token number">0.001</span><span class="token punctuation">)</span>
train <span class="token operator">=</span> optimizer<span class="token punctuation">.</span> minimize<span class="token punctuation">(</span>loss<span class="token punctuation">)</span>

<span class="token comment"># Use two arrays to save the training data</span>
x_train <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span>
y_train <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">4.8</span><span class="token punctuation">,</span> <span class="token number">8.5</span><span class="token punctuation">,</span> <span class="token number">10.4</span><span class="token punctuation">,</span> <span class="token number">21.0</span><span class="token punctuation">,</span> <span class="token number">25.3</span><span class="token punctuation">]</span>

<span class="token comment"># train 10000 times</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
     sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>train<span class="token punctuation">,</span> <span class="token punctuation">{</span>x<span class="token punctuation">:</span> x_train<span class="token punctuation">,</span> y<span class="token punctuation">:</span> y_train<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment"># print the training result</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;W: %s b: %s loss: %s&#39;</span> <span class="token operator">%</span> <span class="token punctuation">(</span>sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>W<span class="token punctuation">)</span><span class="token punctuation">,</span> sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>
     b<span class="token punctuation">)</span><span class="token punctuation">,</span> sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>loss<span class="token punctuation">,</span> <span class="token punctuation">{</span>x<span class="token punctuation">:</span> x_train<span class="token punctuation">,</span> y<span class="token punctuation">:</span> y_train<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="tensorflow-advanced-training-model" tabindex="-1"><a class="header-anchor" href="#tensorflow-advanced-training-model" aria-hidden="true">#</a> TensorFlow advanced training model</h2><p><code>tf.estimator</code> is an advanced library provided by TensorFlow, which provides many commonly used training models, which can simplify many training processes in machine learning, such as:</p><ul><li><p>run the training loop</p></li><li><p>run evaluation loop</p></li><li><p>Manage training datasets</p></li></ul><h3 id="evaluate-the-model" tabindex="-1"><a class="header-anchor" href="#evaluate-the-model" aria-hidden="true">#</a> Evaluate the model</h3><p>In the previous demo, we built a linear model. By using a set of experimental data to train our linear model, we obtained an optimal model that we think has the smallest loss. According to the training results, our optimal model can be expressed as the following equation :</p><blockquote><p>$y=2.98x+2.07$</p></blockquote><p>But will this model we think is optimal always be optimal? We need to <strong>assess (evaluate)</strong> the <strong>generalization performance</strong> of the model through some new experimental data. If the new experimental data is applied to this model, the loss value is smaller, then the model The better the generalization performance is, the worse it will be. In the following demo we will also see how to evaluate the model.</p><h3 id="using-linearregressor" tabindex="-1"><a class="header-anchor" href="#using-linearregressor" aria-hidden="true">#</a> Using LinearRegressor</h3><p>Earlier we built a linear model and obtained a linear regression equation through training. The linear regression training model <code>tf.estimator.LinearRegressor</code> is also provided in <code>tf.estimator</code>. The following code is the method of using <code>LinearRegressor</code> to train and evaluate the model:</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment"># We will use NumPy to process various training data</span>
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf

<span class="token comment"># Create a list of eigenvectors with only one eigenvector in the feature list,</span>
<span class="token comment"># The feature vector is a real vector, an array with only one element, and the element name is x,</span>
<span class="token comment"># We can also create other more complex feature lists</span>
feature_columns <span class="token operator">=</span> <span class="token punctuation">[</span>tf<span class="token punctuation">.</span>feature_column<span class="token punctuation">.</span>numeric_column<span class="token punctuation">(</span><span class="token string">&quot;x&quot;</span><span class="token punctuation">,</span> shape<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

<span class="token comment"># Create a LinearRegressor trainer and pass in a list of feature vectors</span>
estimator <span class="token operator">=</span> tf<span class="token punctuation">.</span>estimator<span class="token punctuation">.</span>LinearRegressor<span class="token punctuation">(</span>feature_columns<span class="token operator">=</span>feature_columns<span class="token punctuation">)</span>

<span class="token comment"># save training data</span>
x_train <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1.</span><span class="token punctuation">,</span> <span class="token number">2.</span><span class="token punctuation">,</span> <span class="token number">3.</span><span class="token punctuation">,</span> <span class="token number">6.</span><span class="token punctuation">,</span> <span class="token number">8.</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
y_train <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4.8</span><span class="token punctuation">,</span> <span class="token number">8.5</span><span class="token punctuation">,</span> <span class="token number">10.4</span><span class="token punctuation">,</span> <span class="token number">21.0</span><span class="token punctuation">,</span> <span class="token number">25.3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># save data for evaluation</span>
x_eavl <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2.</span><span class="token punctuation">,</span> <span class="token number">5.</span><span class="token punctuation">,</span> <span class="token number">7.</span><span class="token punctuation">,</span> <span class="token number">9.</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
y_eavl <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">7.6</span><span class="token punctuation">,</span> <span class="token number">17.2</span><span class="token punctuation">,</span> <span class="token number">23.6</span><span class="token punctuation">,</span> <span class="token number">28.8</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># Create an input model with training data for subsequent model training</span>
<span class="token comment"># The first parameter is used as the input data of the linear regression model</span>
<span class="token comment"># The second parameter is used as the input of the linear regression model loss model</span>
<span class="token comment"># The third parameter batch_size indicates the number of each batch of training data</span>
<span class="token comment"># The fourth parameter num_epochs is the number of epochs, and all the data in the training set are trained once for 1 epoch</span>
<span class="token comment"># The lower five parameters shuffle is to take the training data sequentially or randomly</span>
train_input_fn <span class="token operator">=</span> tf<span class="token punctuation">.</span>estimator<span class="token punctuation">.</span>inputs<span class="token punctuation">.</span>numpy_input_fn<span class="token punctuation">(</span>
     <span class="token punctuation">{</span><span class="token string">&quot;x&quot;</span><span class="token punctuation">:</span> x_train<span class="token punctuation">}</span><span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> batch_size<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> num_epochs<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

<span class="token comment"># Then use the training data to create an input model for later model evaluation</span>
train_input_fn_2 <span class="token operator">=</span> tf<span class="token punctuation">.</span>estimator<span class="token punctuation">.</span>inputs<span class="token punctuation">.</span>numpy_input_fn<span class="token punctuation">(</span>
     <span class="token punctuation">{</span><span class="token string">&quot;x&quot;</span><span class="token punctuation">:</span> x_train<span class="token punctuation">}</span><span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> batch_size<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> num_epochs<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>

<span class="token comment"># Create an input model with evaluation data for later model evaluation</span>
eval_input_fn <span class="token operator">=</span> tf<span class="token punctuation">.</span>estimator<span class="token punctuation">.</span>inputs<span class="token punctuation">.</span>numpy_input_fn<span class="token punctuation">(</span>
     <span class="token punctuation">{</span><span class="token string">&quot;x&quot;</span><span class="token punctuation">:</span> x_eavl<span class="token punctuation">}</span><span class="token punctuation">,</span> y_eavl<span class="token punctuation">,</span> batch_size<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> num_epochs<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>

<span class="token comment"># Use the training data to train 1000 times</span>
estimator<span class="token punctuation">.</span> train<span class="token punctuation">(</span>input_fn<span class="token operator">=</span>train_input_fn<span class="token punctuation">,</span> steps<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">)</span>

<span class="token comment"># Use the original training data to evaluate the model, the purpose is to view the training results</span>
train_metrics <span class="token operator">=</span> estimator<span class="token punctuation">.</span>evaluate<span class="token punctuation">(</span>input_fn<span class="token operator">=</span>train_input_fn_2<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;train metrics: %r&quot;</span> <span class="token operator">%</span> train_metrics<span class="token punctuation">)</span>

<span class="token comment"># Use the evaluation data to evaluate the model, the purpose is to verify the generalization performance of the model</span>
eval_metrics <span class="token operator">=</span> estimator<span class="token punctuation">.</span>evaluate<span class="token punctuation">(</span>input_fn<span class="token operator">=</span>eval_input_fn<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;eval metrics: %s&quot;</span> <span class="token operator">%</span> eval_metrics<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Running the above code outputs:</p><blockquote><p>train metrics: {&#39;loss&#39;: 1.0493528, &#39;average_loss&#39;: 0.52467638, &#39;global_step&#39;: 1000}<br> eval metrics: {&#39;loss&#39;: 0.72186172, &#39;average_loss&#39;: 0.36093086, &#39;global_step&#39;: 1000}</p></blockquote><p>The loss of the evaluation data is smaller than that of the training data, indicating that our model generalization performance is very good.</p><h3 id="custom-estimator-model" tabindex="-1"><a class="header-anchor" href="#custom-estimator-model" aria-hidden="true">#</a> Custom Estimator model</h3><p>The <code>tf.estimator</code> library provides many predefined training models, but it is possible that these training models cannot meet our needs, and we need to use our own built models.<br> We can build our own training model by implementing a subclass of <code>tf.estimator.Estimator</code>, <code>LinearRegressor</code> is a subclass of <code>Estimator</code>. In addition, we can also only provide a <code>model_fn</code> implementation for the <code>Estimator</code> base class, defining our own model training, evaluation methods and methods for calculating losses.<br> The following code is an example of implementing a custom <code>Estimator</code> using the linear model we first built.</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf

<span class="token comment"># Define the model training function, and also define the feature vector</span>
<span class="token keyword">def</span> <span class="token function">model_fn</span><span class="token punctuation">(</span>features<span class="token punctuation">,</span> labels<span class="token punctuation">,</span> mode<span class="token punctuation">)</span><span class="token punctuation">:</span>
     <span class="token comment"># Build a linear model</span>
     W <span class="token operator">=</span> tf<span class="token punctuation">.</span>get_variable<span class="token punctuation">(</span><span class="token string">&quot;W&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>tf<span class="token punctuation">.</span>float64<span class="token punctuation">)</span>
     b <span class="token operator">=</span> tf<span class="token punctuation">.</span>get_variable<span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>tf<span class="token punctuation">.</span>float64<span class="token punctuation">)</span>
     y <span class="token operator">=</span> W <span class="token operator">*</span> features<span class="token punctuation">[</span><span class="token string">&#39;x&#39;</span><span class="token punctuation">]</span> <span class="token operator">+</span> b
     <span class="token comment"># build loss model</span>
     loss <span class="token operator">=</span> tf<span class="token punctuation">.</span>reduce_sum<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>square<span class="token punctuation">(</span>y <span class="token operator">-</span> labels<span class="token punctuation">)</span><span class="token punctuation">)</span>
     <span class="token comment"># training model subgraph</span>
     global_step <span class="token operator">=</span> tf<span class="token punctuation">.</span> train<span class="token punctuation">.</span> get_global_step<span class="token punctuation">(</span><span class="token punctuation">)</span>
     optimizer <span class="token operator">=</span> tf<span class="token punctuation">.</span>train<span class="token punctuation">.</span>GradientDescentOptimizer<span class="token punctuation">(</span><span class="token number">0.01</span><span class="token punctuation">)</span>
     train <span class="token operator">=</span> tf<span class="token punctuation">.</span>group<span class="token punctuation">(</span>optimizer<span class="token punctuation">.</span>minimize<span class="token punctuation">(</span>loss<span class="token punctuation">)</span><span class="token punctuation">,</span>
                      tf<span class="token punctuation">.</span> assign_add<span class="token punctuation">(</span>global_step<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
     <span class="token comment"># Specify our training subgraph positive loss model via EstimatorSpec</span>
     <span class="token keyword">return</span> tf<span class="token punctuation">.</span>estimator<span class="token punctuation">.</span>EstimatorSpec<span class="token punctuation">(</span>
         mode<span class="token operator">=</span>mode<span class="token punctuation">,</span>
         predictions<span class="token operator">=</span>y<span class="token punctuation">,</span>
         loss<span class="token operator">=</span>loss<span class="token punctuation">,</span>
         train_op<span class="token operator">=</span>train<span class="token punctuation">)</span>
    
<span class="token comment"># Create a custom training model</span>
estimator <span class="token operator">=</span> tf<span class="token punctuation">.</span>estimator<span class="token punctuation">.</span>Estimator<span class="token punctuation">(</span>model_fn<span class="token operator">=</span>model_fn<span class="token punctuation">)</span>

<span class="token comment"># The following training logic is the same as using LinearRegressor</span>
x_train <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1.</span><span class="token punctuation">,</span> <span class="token number">2.</span><span class="token punctuation">,</span> <span class="token number">3.</span><span class="token punctuation">,</span> <span class="token number">6.</span><span class="token punctuation">,</span> <span class="token number">8.</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
y_train <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4.8</span><span class="token punctuation">,</span> <span class="token number">8.5</span><span class="token punctuation">,</span> <span class="token number">10.4</span><span class="token punctuation">,</span> <span class="token number">21.0</span><span class="token punctuation">,</span> <span class="token number">25.3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

x_eavl <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2.</span><span class="token punctuation">,</span> <span class="token number">5.</span><span class="token punctuation">,</span> <span class="token number">7.</span><span class="token punctuation">,</span> <span class="token number">9.</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
y_eavl <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">7.6</span><span class="token punctuation">,</span> <span class="token number">17.2</span><span class="token punctuation">,</span> <span class="token number">23.6</span><span class="token punctuation">,</span> <span class="token number">28.8</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

train_input_fn <span class="token operator">=</span> tf<span class="token punctuation">.</span>estimator<span class="token punctuation">.</span>inputs<span class="token punctuation">.</span>numpy_input_fn<span class="token punctuation">(</span>
     <span class="token punctuation">{</span><span class="token string">&quot;x&quot;</span><span class="token punctuation">:</span> x_train<span class="token punctuation">}</span><span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> batch_size<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> num_epochs<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

train_input_fn_2 <span class="token operator">=</span> tf<span class="token punctuation">.</span>estimator<span class="token punctuation">.</span>inputs<span class="token punctuation">.</span>numpy_input_fn<span class="token punctuation">(</span>
     <span class="token punctuation">{</span><span class="token string">&quot;x&quot;</span><span class="token punctuation">:</span> x_train<span class="token punctuation">}</span><span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> batch_size<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> num_epochs<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>

eval_input_fn <span class="token operator">=</span> tf<span class="token punctuation">.</span>estimator<span class="token punctuation">.</span>inputs<span class="token punctuation">.</span>numpy_input_fn<span class="token punctuation">(</span>
     <span class="token punctuation">{</span><span class="token string">&quot;x&quot;</span><span class="token punctuation">:</span> x_eavl<span class="token punctuation">}</span><span class="token punctuation">,</span> y_eavl<span class="token punctuation">,</span> batch_size<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> num_epochs<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>

estimator<span class="token punctuation">.</span> train<span class="token punctuation">(</span>input_fn<span class="token operator">=</span>train_input_fn<span class="token punctuation">,</span> steps<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">)</span>

train_metrics <span class="token operator">=</span> estimator<span class="token punctuation">.</span>evaluate<span class="token punctuation">(</span>input_fn<span class="token operator">=</span>train_input_fn_2<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;train metrics: %r&quot;</span> <span class="token operator">%</span> train_metrics<span class="token punctuation">)</span>

eval_metrics <span class="token operator">=</span> estimator<span class="token punctuation">.</span>evaluate<span class="token punctuation">(</span>input_fn<span class="token operator">=</span>eval_input_fn<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;eval metrics: %s&quot;</span> <span class="token operator">%</span> eval_metrics<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The output of the above code is</p><blockquote><p>train metrics: {&#39;loss&#39;: 0.8984344, &#39;global_step&#39;: 1000}<br> eval metrics: {&#39;loss&#39;: 0.48776609, &#39;global_step&#39;: 1000}</p></blockquote><h3 id="tensorboard" tabindex="-1"><a class="header-anchor" href="#tensorboard" aria-hidden="true">#</a> TensorBoard</h3><p>In order to facilitate the modeling and tuning of TensorFlow, Google has also developed a visual tool for TensorFlow: TensorBoard. After slightly modifying the code of our first Demo, we can use TensorBoard to understand the training process of TensorFlow more intuitively.</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf

<span class="token comment"># Set the name when creating a node for easy identification in the graph</span>
W <span class="token operator">=</span> tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">&#39;W&#39;</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">&#39;b&#39;</span><span class="token punctuation">)</span>

<span class="token comment"># Set the name when creating a node for easy identification in the graph</span>
x <span class="token operator">=</span> tf<span class="token punctuation">.</span>placeholder<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">&#39;x&#39;</span><span class="token punctuation">)</span>
y <span class="token operator">=</span> tf<span class="token punctuation">.</span>placeholder<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">&#39;y&#39;</span><span class="token punctuation">)</span>

<span class="token comment"># linear model</span>
linear_model <span class="token operator">=</span> W <span class="token operator">*</span> x <span class="token operator">+</span> b

<span class="token comment"># The loss model is hidden in the loss-model module</span>
<span class="token keyword">with</span> tf<span class="token punctuation">.</span>name_scope<span class="token punctuation">(</span><span class="token string">&quot;loss-model&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
     loss <span class="token operator">=</span> tf<span class="token punctuation">.</span>reduce_sum<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>square<span class="token punctuation">(</span>linear_model <span class="token operator">-</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
     <span class="token comment"># Add scalar to the output of the loss model to observe the convergence curve of loss</span>
     tf<span class="token punctuation">.</span>summary<span class="token punctuation">.</span>scalar<span class="token punctuation">(</span><span class="token string">&quot;loss&quot;</span><span class="token punctuation">,</span> loss<span class="token punctuation">)</span>

optmizer <span class="token operator">=</span> tf<span class="token punctuation">.</span>train<span class="token punctuation">.</span>GradientDescentOptimizer<span class="token punctuation">(</span><span class="token number">0.001</span><span class="token punctuation">)</span>

train <span class="token operator">=</span> optmizer<span class="token punctuation">.</span> minimize<span class="token punctuation">(</span>loss<span class="token punctuation">)</span>

x_train <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span>
y_train <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">4.8</span><span class="token punctuation">,</span> <span class="token number">8.5</span><span class="token punctuation">,</span> <span class="token number">10.4</span><span class="token punctuation">,</span> <span class="token number">21.0</span><span class="token punctuation">,</span> <span class="token number">25.3</span><span class="token punctuation">]</span>

sess <span class="token operator">=</span> tf<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span>
init <span class="token operator">=</span> tf<span class="token punctuation">.</span>global_variables_initializer<span class="token punctuation">(</span><span class="token punctuation">)</span>
sess<span class="token punctuation">.</span> run<span class="token punctuation">(</span>init<span class="token punctuation">)</span>

<span class="token comment"># Call merge_all() to collect all operation data</span>
merged <span class="token operator">=</span> tf<span class="token punctuation">.</span>summary<span class="token punctuation">.</span>merge_all<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># All data generated by model running is saved to /tmp/tensorflow folder for TensorBoard to use</span>
writer <span class="token operator">=</span> tf<span class="token punctuation">.</span>summary<span class="token punctuation">.</span>FileWriter<span class="token punctuation">(</span><span class="token string">&#39;/tmp/tensorflow&#39;</span><span class="token punctuation">,</span> sess<span class="token punctuation">.</span>graph<span class="token punctuation">)</span>

<span class="token comment"># train 10000 times</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
     <span class="token comment"># Pass in merge during training</span>
     summary<span class="token punctuation">,</span> _ <span class="token operator">=</span> sess<span class="token punctuation">.</span> run<span class="token punctuation">(</span><span class="token punctuation">[</span>merged<span class="token punctuation">,</span> train<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>x<span class="token punctuation">:</span> x_train<span class="token punctuation">,</span> y<span class="token punctuation">:</span> y_train<span class="token punctuation">}</span><span class="token punctuation">)</span>
     <span class="token comment"># Collect the data generated by each training</span>
     writer<span class="token punctuation">.</span> add_summary<span class="token punctuation">(</span>summary<span class="token punctuation">,</span> i<span class="token punctuation">)</span>

curr_W<span class="token punctuation">,</span> curr_b<span class="token punctuation">,</span> curr_loss <span class="token operator">=</span> sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>
     <span class="token punctuation">[</span>W<span class="token punctuation">,</span> b<span class="token punctuation">,</span> loss<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>x<span class="token punctuation">:</span> x_train<span class="token punctuation">,</span> y<span class="token punctuation">:</span> y_train<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;After train W: %s b %s loss: %s&quot;</span> <span class="token operator">%</span> <span class="token punctuation">(</span>curr_W<span class="token punctuation">,</span> curr_b<span class="token punctuation">,</span> curr_loss<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>After running the above code, the data generated during the training process will be saved in the /tmp/tensorflow folder. We can run the following command on the command line terminal to start TensorBoard:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># Set the directory where we store the training data via the --logdir parameter</span>
$ tensorboard <span class="token parameter variable">--logdir</span> /tmp/tensorflow
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>Then open the <code>http://localhost:6006</code> page in the browser to see our model data.<br> First, on the <strong>SCALARS</strong> page, we can see the loss convergence curve we set through <code>tf.summary.scalar(&quot;loss&quot;, loss)</code>. From the graph, we can see that the loss is about 2000 times after training. It has almost converged.</p><figure><img src="`+m+'" alt="Convergence Curve" tabindex="0" loading="lazy"><figcaption>Convergence Curve</figcaption></figure><p>On the <strong>GRAPHS</strong> page, you can see the data flow diagram of the model we built:</p><figure><img src="'+v+'" alt="Data flow diagram" tabindex="0" loading="lazy"><figcaption>Data flow diagram</figcaption></figure><p>Among them, the loss model is folded into the loss-model module. Double-click the module to expand the content of the loss model:</p><figure><img src="'+b+'" alt="Loss model" tabindex="0" loading="lazy"><figcaption>Loss model</figcaption></figure><p>– end –</p><p>The above is the introductory demo when I first learned TensorFlow. If you want to have a deeper understanding of TensorFlow, you can refer to the following website:</p>',32),_={href:"https://www.tensorflow.org/",target:"_blank",rel:"noopener noreferrer"},x={href:"https://tensorflow.google.cn/",target:"_blank",rel:"noopener noreferrer"},T={href:"http://wiki.jikexueyuan.com/project/tensorflow-zh/",target:"_blank",rel:"noopener noreferrer"},q=n("hr",null,null,-1),z=n("br",null,null,-1),W={href:"https://blog.csdn.net/geyunfei_/article/details/78782804",target:"_blank",rel:"noopener noreferrer"};function C(F,A){const a=o("ExternalLinkIcon");return i(),c("div",null,[g,n("p",null,[s("Let's sort out the previous code. The complete demo code is as follows. Save the following code in a "),n("a",f,[s("demo.py"),t(a)]),s(" file and execute it through "),y,s(" to see the training results:")]),w,n("ul",null,[n("li",null,[n("p",null,[n("a",_,[s("Official Website"),t(a)])])]),n("li",null,[n("p",null,[n("a",x,[s("Official Chinese website"),t(a)])])]),n("li",null,[n("p",null,[n("a",T,[s("Chinese document translated by domestic enthusiasts"),t(a)])])])]),q,n("p",null,[s('This article is the original article of CSDN blogger "Ge Yunfei", and the reprint is only for self-study.'),z,s(" Original link: "),n("a",W,[s("https://blog.csdn.net/geyunfei_/article/details/78782804"),t(a)])])])}const I=p(h,[["render",C],["__file","2018122117.html.vue"]]);export{I as default};
